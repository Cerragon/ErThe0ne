#pragma once

#include <array>
#include <cstdint>

class Opk
{
public:
	static bool SetOpkData(bool enabled);
	static bool OnePositionKill(const bool enabled);
private:
	inline static const std::array<unsigned char, 15> opk_off = { 0x0F, 0x10, 0x87, 0x90, 0x04, 0x00, 0x00, 0x0F, 0x58, 0x45, 0xA7, 0x0F, 0x29, 0x45, 0xF7 };

	inline static std::uintptr_t opkPage = 0;
	inline static bool opkPageValid = false;

	class OpkData
	{
	public:
		unsigned char opkAsm[0x70]
		{
			0x31, 0xC0,                                     //xor eax, eax
			0x3B, 0x05, 0x68, 0x00, 0x00, 0x00,             //cmp eax, [OpkPlayers]
			0x74, 0x14,                                     //je OpkNpcsCheck
			0x8B, 0x87, 0xC0, 0x03, 0x00, 0x00,             //mov eax,[rdi+000003C0]
			0x83, 0xF8, 0x02,                               //cmp eax, 02
			0x75, 0x09,                                     //jne OpkNpcsCheck
			0x0F, 0x28, 0x05, 0x64, 0x00, 0x00, 0x00,       //movaps xmm0, [OpkPlayerPosition]
			0xEB, 0x2A,                                     //jmp OriginalFunction
			0x31, 0xC0,                                     //xor eax, eax
			0x3B, 0x05, 0x4E, 0x00, 0x00, 0x00,             //cmp eax, [OpkNpcs]
			0x74, 0x14,                                     //je OriginalFunction
			0x8B, 0x87, 0xC0, 0x03, 0x00, 0x00,             //mov eax,[rdi+000003C0]
			0x83, 0xF8, 0x03,                               //cmp eax, 03
			0x75, 0x09,                                     //jne OriginalFunction
			0x0F, 0x28, 0x05, 0x56, 0x00, 0x00, 0x00,       //movaps xmm0, [OpkNpcPosition]
			0xEB, 0x0C,                                     //jmp OriginalFunction
			0x0F, 0x10, 0x87, 0x90, 0x04, 0x00, 0x00,       //movups xmm0,[rdi+00000490]
			0x0F, 0x58, 0x45, 0xA7,                         //addps xmm0,[rbp-59]
			0x90,                                           //nop 
			0x0F, 0x29, 0x45, 0xF7,                         //movaps [rbp-09],xmm0
			0x48, 0x8D, 0x05, 0x25, 0x00, 0x00, 0x00,       //lea rax,[FunctionReturn]
			0x48, 0x8B, 0x00,                               //mov rax,[rax]
			0xFF, 0xE0,                                     //jmp rax
			0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC, //Padding
			0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC, //Padding
			0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC, //Padding
		};
		int opkPlayers = 0;
		int opkNpcs = 0;
		std::uintptr_t originalFunction = 0;
		float opkPlayerPosition[4] = {};
		float opkNpcPosition[4] = {};
	};
};
